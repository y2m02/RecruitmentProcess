@using Kendo.Mvc
@using RecruitmentManagementApp.Models.ViewModels
@{
    ViewData["Title"] = "Candidatos";
}

<style>
    .k-command-cell.k-command-cell.k-command-cell {
        text-align: center;
    }

    .k-grid-content {
        min-height: 70px;
    }

    #btnOpenModal, #btnEdit, #btnDelete {
        color: white;
        font-weight: bold;
    }
</style>

<h1>Candidatos</h1>
<br />
<div>
    @*<div>
        <button id="openModal" type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModalCandidate">
            <i class="fas fa-plus"
               aria-hidden="true">
            </i>
            Crear
        </button>
        <br />
        <br />
    </div>*@
    @await Html.PartialAsync("UpsertPartial")
    <div>
        @(Html.Kendo().Grid<CandidateViewModel>()
            .Name("Candidates")
            .Columns(columns =>
            {
                columns.Select().Width(50).ClientHeaderTemplate(" ");
                columns.Bound(c => c.Id).Hidden();
                columns.Bound(c => c.Name).Groupable(false).Width(200);
                columns.Bound(c => c.CreatedDate).Format("{0:dd/MM/yyyy}").Width(150);
                columns.Bound(c => c.StatusDescription)
                    .Filterable(ftb => ftb
                        .Multi(true)
                        .CheckAll(false)
                        .Messages(msg => msg.SelectedItemsFormat("{0} opciones seleccionadas"))
                    )
                    .Width(150);
                columns.Bound(c => c.Curriculum).Groupable(false).Width(200);
                columns.Bound(c => c.GitHub).Groupable(false).Width(200);
            })
            .ToolBar(
                x =>
                {
                    x.Custom().Name("+").HtmlAttributes(new { id = "btnOpenModal", @class = "btn btn-primary", type = "button" });
                    x.Custom().Name("e").HtmlAttributes(new { id = "btnEdit", @class = "btn btn-success", type = "button" });
                    x.Custom().Name("x").HtmlAttributes(new { id = "btnDelete", @class = "btn btn-danger", type = "button", onClick = "Edit();" });
                }
            )
            .Resizable(c => c.Columns(true))
            .Pageable(pageable => pageable
                .Refresh(true)
                .PageSizes(new[] { 20, 35, 50, 100 })
                .Messages(msg => msg
                    .Empty("Sin registros")
                    .ItemsPerPage("registros por página")
                    .First("Ir a la primera página")
                    .Last("Ir a la última página")
                    .Next("Página siguiente")
                    .Previous("Página anterior")
                    .Refresh("Refrescar")
                    .Display("{0} - {1} de {2} registros")
                    .Page("Página")
                    .MorePages("Más páginas")))
            .Navigatable()
            .Sortable()
            .Groupable(g => g.Messages(m => m.Empty("Arrastre una columna hasta aquí para agrupar por dicha columna")))
            .Filterable(filterable => filterable
                .Extra(true)
                .Operators(op =>
                    op.ForString(str => str.Clear()
                        .Contains("Contiene")
                        .DoesNotContain("No contiene")
                        .IsEqualTo("Es igual a")
                        .IsNotEqualTo("Es diferente de")
                        .StartsWith("Comienza con")
                        .EndsWith("Termina con"))
                        .ForDate(date => date.Clear()
                            .IsEqualTo("Es igual a")
                            .IsNotEqualTo("Es diferente de")
                            .IsGreaterThanOrEqualTo("Mayor o igual que")
                            .IsGreaterThan("Después de")
                            .IsLessThanOrEqualTo("Hasta")
                            .IsLessThan("Antes de"))
                        .ForNumber(num => num.Clear()
                            .IsEqualTo("Es igual a")
                            .IsNotEqualTo("Es diferente de")
                            .IsGreaterThanOrEqualTo("Mayor o igual que")
                            .IsGreaterThan("Mayor que")
                            .IsLessThanOrEqualTo("Menor o igual que")
                            .IsLessThan("Menor que")))
                .Messages(msg => msg
                    .Info("Mostrar registros con valor que:")
                    .And("Y")
                    .Or("O")
                    .Filter("Filtrar")
                    .Clear("Limpiar")))
            .Height(550)
            .Scrollable()
            .DataSource(dataSource => dataSource
                .Ajax()
                .PageSize(20)
                .ServerOperation(false)
                .Sort(s => s.Add("StatusDescription").Descending())
                .Model(model => model.Id(p => p.Id))
                .Read(read => read.Action("GetAll", "Candidate"))
                .Group(group => group.Add("StatusDescription", typeof(string), ListSortDirection.Ascending))
            ))
    </div>
</div>

<script src="~/js/candidate.js"></script>

<script>
$(function(){
    $("#btnOpenModal, #btnEdit, #btnDelete").removeClass("k-button k-button-icontext");
   
    $('#btnOpenModal').attr('data-toggle', 'modal');
    $('#btnOpenModal').attr('data-target', '#myModalCandidate');
    
    var grid = $("#Candidates").data("kendoGrid");

    grid.tbody.on("click", ".k-checkbox", onChange);
})
    
    function onChange(e) {
        var grid = $("#Candidates").data("kendoGrid");
        var row = $(e.target).closest("tr");

        if (row.hasClass("k-state-selected")) {
            setTimeout(function (e) {
                var grid = $("#Candidates").data("kendoGrid");
                grid.clearSelection();
            })
        } else {
            grid.clearSelection();
        };

        //if (rows.length == 0) {
        //    window.$("#btnOpenModal").prop("disabled", true);
        //} else {
        //    var grid = window.$("#Payments").data("kendoGrid");

        //    rows.each(function () {
        //        var rowData = grid.dataItem(this);

        //        selectedRecords.push(rowData);
        //    });

        //    window.$("#btnOpenModal").prop("disabled", false);
        //}
    }
    function Edit(){
        var allSelected = $("#Candidates tr.k-state-selected");

        if (allSelected.length > 0) {
            var totalAmount = 0;

            $.each(allSelected, function (e) {
                var row = $(this);

                var grid = row.closest(".k-grid").data("kendoGrid");

                var dataItem = grid.dataItem(row);
            });
        }
    }
</script>